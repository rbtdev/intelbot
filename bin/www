#!/usr/bin/env node
var debug = require('debug')('slack');
var app = require('../app');
var Bot = require('../bot');

console.log("Starting bots...")
var teams = JSON.parse(process.env.TEAMS);
teams.forEach( function (team) {
	console.log("team = " + JSON.stringify(team))
	var bot = new Bot(team.key);
})

// console.log("Teams = " + teams);
// var rbtbot = new Bot('xoxb-3777510376-rDcLi2PdaeH53pSiseUvREHX');
// var sdebot = new Bot('xoxb-3784724122-4t6lOhZssdoRHfaQGgLOzj8j');

console.log("Scheduling ping...")
setInterval(function () {
	var http = require('http');
	console.log("Ping...");
	//The url we want is: 'www.random.org/integers/?num=1&min=1&max=10&col=1&base=10&format=plain&rnd=new'
	var options = {
	  host: 'ingressbot.herokuapp.com',
	  path: '/ping'
	};

	callback = function(response) {
	  var str = '';
	  response.on('data', function (chunk) {
	    str += chunk;
	  });
	  response.on('end', function () {
	    console.log(str);
	  });
	}
	http.request(options, callback).end();
}, 15*60*1000);


app.set('port', process.env.PORT || 3000);
var server = app.listen(app.get('port'), function() {
  console.log('Express server listening on port ' + server.address().port);
});
